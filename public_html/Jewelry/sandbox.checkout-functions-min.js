var beenclicked=!1,creditFieldsBound=!1,giftCardBound=!1,haveBeenUnbound=!1,useShipping=!1,giftCardOnly,i;$.activateCardAddressFields=function(a){var e=[],t=0;if(e[0]="billtofname",e[1]="billtolname",e[2]="card-address",e[3]="card-city",e[4]="card-state",e[5]="card-zip",a===!0){for(t=0;6>t;t++)$("#"+e[t]).addClass("validate"),$("#"+e[t]).attr("disabled",null);$("#card-phone").attr("disabled",null),$("#card-country").attr("disabled",null),$("#card-address-fields").addClass("active")}else{var n=[];for(n[0]="validate",n[1]="valid",n[2]="error",$("#card-address-fields").removeClass("active"),t=0;6>t;t++){for(i=0;3>i;i++)$("#"+e[t]).removeClass(n[i]),$("#"+e[t]+"-validate").removeClass(n[i]);$("#"+e[t]).val(""),$("#"+e[t]).attr("disabled","true"),$("#"+e[t]+"-validate").html(""),$("#"+e[t]).attr("placeholder","")}$("#card-phone").val(""),$("#card-phone").attr("disabled","true"),$("#card-country").attr("disabled","true"),$("#card-country").val("")}},$.bindApplyCode=function(a){$("#apply-card").on("click",function(){$("#gift-card-code").val(""),$.get("get-invoice-total.php",function(e){var t=$("#apply-card").data("balance"),i=parseFloat(t);i>parseFloat(e)&&(i=parseFloat(e));var n=parseFloat(e)-i,s="giftcardcode="+a+"&giftcardamount="+i;$("#temp-balance").attr("data-value",n),$("#temp-balance").html("$"+parseFloat(n).toFixed(2)),$.post("update-with-gift-card.php",s,function(){$.refreshOrderSummary()}),0>=n?(n=0,$("#paypal-fields").fadeOut(),$("#pay-with-giftcard").fadeIn(),$.bindProcessWithGiftCard()):($("#pay-with-giftcard").fadeOut(),$.get("paymentiframe.php",function(a){$("#paypal-fields").html(a),$("#paypal-fields").fadeIn()})),$("#gift-card-validate").html("")})})},$.bindGiftCardField=function(){$("#gift-card-code").bind("blur",function(){if(""!==$(this).val()){var a=$(this).val();$.checkGiftCardCode(a)}})},$.bindProcessWithGiftCard=function(){},$.bindRemoveButtons=function(){var a="";$("#order-summary-main .remove-button").each(function(){$(this).bind("click",function(){var e=confirm("Remove this item from your invoice?");e&&(a=$(this).data("remove"),$.removeItem(a))})})},$.bindRemoveGiftCard=function(){$(".removeGiftCard").bind("click",function(){var a=confirm("Are  you sure you want to remove this gift card?\n\rRemoving this gift card will not prevent you from redeeming it in the future.");a===!0&&$.post("removeGiftCard.php","code="+$(this).attr("id"),function(a){$.refreshOrderSummary(),$("#temp-balance").data("value")>0&&$("#pay-with-giftcard").fadeOut(),$.get("paymentiframe.php",function(a){$("#paypal-fields").html(a),$("#paypal-fields").fadeIn()})})})},$.bindSaveShipping=function(){$("#save-shipping").bind("click",function(){$.checkForm2("shipping-info");var a=$("#shipping-info #form-status").html();if("valid"===a)$.saveShippingInfo();else{var e=$("#form-status").html(),t=$("#"+a).attr("err-msg");window.alert(t),$("#"+e).focus()}})},$.bindUpdateQuantity=function(){$("#update-quantities").bind("click",function(){var a=$(this).data("value").toString();$.updateItems(a,"","self"),$.ajax({type:"POST",url:"https://www.asyoulikeitsilvershop.com/sandbox.orderdetailsAJAX.php",success:function(a){$("#invoice-items").html(a),$.bindRemoveButtons(),$.bindUpdateQuantity(),a.indexOf("empty")>0?$("#check-out-button").css("display","none"):$("#check-out-button").css("display","inline-block")}})})},$.checkForData=function(a){var e=!1;return $("#"+a+" input").each(function(){""!==$(this).val()&&(e=!0)}),e||$("#"+a+" select").each(function(){""!==$(this).val()&&(e=!0)}),e},$.checkForSession=function(){$.ajax({type:"get",url:"checkforsession.php",datatype:"json",success:function(a){if("not set"!==a){var e=$.parseJSON(a);globalSessionData=e,e&&($("#email").val(e.cardemail),$("#fname").val(e.fname),$("#lname").val(e.lname),$("#address1").val(e.address1),$("#address2").val(e.address2),$("#phone").val(e.phone),$("#card-note").val(e.note),$("#gift-wrap").val(e.giftwrap),5==e.shipmethod?($("#city").val(e.cardcity),$("#state").val(e.cardstate),$("#zip").val(e.cardzip),$("#phone").val(e.cardphone),$("#use-shipping-checkbox-container").css("display","none"),$.activateCardAddressFields(!1)):($("#use-shipping-checkbox-container").css("display","inherit"),e.fname?($("#city").val(e.city),$("#state").val(e.state),$("#zip").val(e.zip),$("#use-shipping-address").val(e.sameaddress),"yes"===e.sameaddress?($("#use-shipping-address").attr("checked","true"),$.activateCardAddressFields(!1),useShipping=!0,$("#card-address-fields [input=text]").each(function(){$(this).val(""),$(this).attr("disabled","true")}),$("#card-address-fields [input=select]").each(function(){$(this).attr("disabled","true")})):($("#billtofname").val(e.cardfname),$("#billtolname").val(e.cardlname),$("#card-address").val(e.cardaddress),$("#card-city").val(e.cardcity),$("#card-state").val(e.cardstate),$("#card-zip").val(e.cardzip),$("#card-phone").val(e.cardphone),$("#card-address-fields [input=text]").each(function(){$(this).attr("disabled",null)}),$("#card-address-fields [input=select]").each(function(){$(this).attr("disabled",null)})),$.checkEntireForm("shipping-info")):($("#use-shipping-address").attr("checked","true"),$("#use-shipping-address").val("yes"),$.activateCardAddressFields(!1),$("#email").focus())))}}})},$.checkGiftCardCode=function(a){""!==a&&($("#gift-card-validate").html('Checking code...<img src="/images/ajax-loader.gif" height="20">'),$.get("checkGiftCard.php","gc="+a,function(e){$.loadGiftCardData(e,a)}))},$.checkForGiftCards=function(){var a=[],e=0,t=decodeURIComponent(document.cookie),n=t.indexOf("items=");if(hasGiftCard=!1,giftCardOnly=1,0>n)hasGiftCard=!1,giftCardOnly=0;else for(t=t.substring(n+6),n=0,e=t.indexOf(";"),1>e&&(e=t.length),t=t.substring(n,e),a=t.split("&"),i=0;i<a.length;i++)""!==a[i]&&("gc"!==a[i].substring(0,2)?giftCardOnly=0:hasGiftCard=!0);$("#gift-card-only").val(giftCardOnly)},$.getCityState=function(a){var e="https://api.zippopotam.us/us/"+$("#zip").val(),t="",i="",n="",s="",r="",d="";$.get(e,function(e){var o=jQuery.parseJSON(e),l=e.places[0]["place name"],c=e.places[0]["state abbreviation"],p="";""!=l&&$("#city").val(l),""!=c&&$("#state").val(c),5==globalSessionData.shipmethod?(t=$("#zip").val(),r=$("#city").val(),d=$("#state").val(),i="70115",n="New Orleans",s="LA"):(i=$("#zip").val(),s=$("#state").val(),n=$("#city").val(),"yes"===$("#use-shipping-address").val()&&(t=i,r=n,d=s)),p="zip="+i+"&city="+n+"&state="+s,p=p+"&cardcity="+r+"&cardstate="+d+"&cardzip="+t,console.log("updating session with "+p),$.get("updateSession.php",p,function(e){console.log(e),5!=globalSessionData.shipmethod&&(1===a&&$("#order-summary-overlay").fadeIn(),$.post("getsalestax.php",p,function(){$.post("shippingRatesBeta.php","zip="+i,function(){$.refreshOrderSummary()})}))})},"json")},$.loadGiftCardData=function(a,e){if(a&&"invalid"!==a)if(a>0){var t="Card balance: $"+a+'<a class="link" style="" id="apply-card" data-balance="'+a+'">Apply</a>';$("#gift-card-validate").html(t),$.bindApplyCode(e)}else $("#gift-card-validate").html("This card has no balance");else $("#gift-card-validate").html("Sorry, the code you entered was not found.")},$.processOrder=function(){$.get("sessionBalance.php",function(a){if(0===a)document.location.href="/order-confirmation.php?giftcardtransaction==1";else{var e=parseFloat(a);alert("This invoice has a balance of $"+e+"\n\rPlease enter your payment information")}})},$.refreshOrderSummary=function(a,e){var t="gconly="+giftCardOnly;1===a?t="gconly="+giftCardOnly+"&showBilling=1":2===a&&(t="gconly="+giftCardOnly+"&editBilling=1"),e&&(t="cardcode="+e),$.post("sandbox.updateOrderSummary.php",t,function(e){$("#order-summary").html(e),$.bindRemoveGiftCard(),$("#edit-shipping").bind("click",function(){$.updateStep(1,-1),$("#billing-container").fadeOut(),$("#shipping-container").fadeIn(),$.refreshOrderSummary(2)}),a&&$("#edit-billing").bind("click",function(){$.updateStep(1,-1),$("#order-summary").addClass("fiveColumns"),$("#order-summary").removeClass("tenColumns"),$("#checkout-form").css({display:"inline-block"}),$.refreshOrderSummary(2)})})},$.resetShipping=function(){$("#shipping-method option[value=-1]").each(function(){$(this).remove()}),$("#shipping-method option[value=0").attr("selected","selected")},$.saveBillingInfo=function(){$.ajax({type:"POST",url:processURL,data:$("#billing-info").serialize(),success:function(){$.refreshOrderSummary(1),$("#checkout-form").css({display:"none"}),$("#order-summary").removeClass("fiveColumns"),$("#order-summary").addClass("tenColumns"),$.updateStep(4,1),$("#checkout-forms").fadeIn()}})},$.saveShippingInfo=function(){$("#transition").css("display","inline-block"),"no"===$("#use-shipping-address").val();var a=$("#shipping-info"),e=a.find(":input:disabled").removeAttr("disabled"),t=a.serialize();$("#use-shipping-address").attr("disabled",null),e.attr("disabled","disabled");var i="paymentiframe.php";$.post("https://www.asyoulikeitsilvershop.com/"+i,t,function(a){setTimeout(function(){$("#transition").css("display","none")},1e3),$.showBillingForm(a),$.refreshOrderSummary(1)})},$.showOrderSummary=function(){$.ajax({type:"POST",url:"sandbox.orderdetails.php",success:function(a){$("#invoice-items").html(a),$("#check-out").bind("click",function(){$.updateStep(1,1),$.updateStep(2,1),$("#order-summary-main").fadeOut(),$("#checkout-forms").fadeIn(),$.resetShipping(),$.showShippingForm()}),$.bindRemoveButtons(),$.bindUpdateQuantity(),a.indexOf("empty")>0?($("#check-out-button").css("display","none"),$("#express-checkout").css("display","none")):($("#check-out-button").css("display","inline-block"),$("#express-checkout").css("display","inline-block"))}})},$.showBillingForm=function(a){var e="auto";1===hasGiftCard&&(e="none"),$(".giftcard-container").each(function(){$(this).css("display",e)}),$.updateStep(2,1),$("#shipping-container").fadeOut();var t=a.replace("<iframe",'<iframe id="paypalFrame" ');$("#temp-balance").data("value")>0?($("#paypal-fields").html(t),$("#pay-with-giftcard").fadeOut()):$("#pay-with-giftcard").fadeIn(),$("#billing-container").fadeIn();var i=$.checkForData("payment-information");creditFieldsBound||(creditFieldsBound=!0,i&&$.checkEntireForm("billing-info")),$(".shadowbox:first").css("display:none")},$.showShippingForm=function(){$("#checkout-forms").fadeIn(),$("#shipping-container").fadeIn(),useShipping?($("#use-shipping-address").attr("checked","checked"),$("#use-shipping-address").val("yes"),$.activateCardAddressFields(!1)):($("#use-shipping-address").attr("checked",null),$("#use-shipping-address").val("no"),$.activateCardAddressFields(!0),$.bindValidation("card-address-fields")),$.get("sandbox.updateOrderSummary.php","gconly="+giftCardOnly,function(a){$("#order-summary").html(a),$("#subtotal").val($("#temp-subtotal").attr("data-value")),$("#shipping").val($("#temp-shipping").attr("data-value")),$("#total").val($("#temp-total").attr("data-value")),$("#tax").val($("temp-tax").attr("data-value")),console.log("checking to see if gift cards are on invoice"),$(".giftCard")[0]&&$.bindRemoveGiftCard()})},$.updateOrderSummary=function(){var a=[];a[0]="Ground, 8-10 days",a[6]="3-day select UPS",a[23]="Second day air",a[49]="Next day air";var e=$("#temp-subtotal").data("value"),t=$("#temp-gift-card").data("value");isNaN(parseInt(t))&&(t=0);var i=$("#shipping-method").val();isNaN(i)&&(i=$("#temp-shipping-surcharge").data("value"));var n=$("#temp-shipping-subtotal").data("value"),s=$("#temp-tax").data("value");n=parseInt(n)+parseInt(i);var r=parseInt(e)+parseInt(n)+parseInt(s);r=parseInt(r);var d=r-parseInt(t);0>d&&(d=0),$("#temp-shipping-surcharge").attr("data-value",i),$("#temp-shipping-surcharge").html("$"+parseFloat(i).toFixed(2)),$("#temp-shipping").attr("data-value",n),$("#temp-shipping").html("$"+parseFloat(n).toFixed(2)),$("#temp-total").attr("data-value",r),$("#temp-total").html("$"+parseFloat(r).toFixed(2)),$("#temp-balance").html("$"+parseFloat(d).toFixed(2)),$("#shipping-text").html(a[i]),$("#subtotal").val($("#temp-subtotal").attr("data-value")),$("#shipping").val($("#temp-shipping").attr("data-value")),$("#total").val($("#temp-total").attr("data-value")),$("#tax").val($("temp-tax").attr("data-value"))},$.updateStep=function(a,e){var t;if(1===e)for(t=1;4>t;t++)t===a?$("#step-"+t).addClass("current"):$("#step-"+t).removeClass("current");else for(t=3;t>0;t--)t===a?$("#step-"+t).addClass("current"):$("#step-"+t).removeClass("current")},$.zeroShipping=function(){$("#shipping-method").append('<option value="-1" selected="selected">No charge</option>'),$("#shipping-method option[value=0]").attr("selected",null)},$.main=function(){$("#gift-card-only").val(giftCardOnly),$.bindGiftCardField(),$("#process-giftcard").on("click",function(){console.log("I was clicked?"),$("#giftCardPayOverlay").fadeIn()}),$("#resume-shopping").on("click",function(){window.location.href="http://www.asyoulikeitsilvershop.com"}),$("#use-shipping-address").on("click",function(){beenclicked=!0,$(this).attr("checked")?($(this).val("yes"),$.activateCardAddressFields(!1)):($(this).val("no"),$.activateCardAddressFields(!0),$.bindValidation("card-address-fields"),$("#billtofname").focus())}),$("#review-order").on("click",function(){$.checkForm2("billing-info");var a=$("#form-status").html();if("valid"===a)$.saveBillingInfo();else{var e=$("#form-status").html(),t=$("#"+a).attr("err-msg");window.alert(t),$("#"+e).focus()}}),$.bindValidation("shipping-info"),$.bindSaveShipping(),$("#shipping-method").on("change",function(){$.updateOrderSummary()}),$("#zip").on("change",function(){var a=$(this).val();5===a.length?$.getCityState(1):alert("Please enter a valid 5-digit zip code")}),$("#edit-billing").on("click",function(){$.updateStep(3,-1),$("#billing-container").fadeIn()}),document.cookie.indexOf("custNum")>0?($.checkForSession(),$.showShippingForm(1,0)):document.cookie.indexOf("items")>0&&($.checkForSession(),$.showShippingForm(1,0)),""!==$("#zip").val()&&$.getCityState(0)};